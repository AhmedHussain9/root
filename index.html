<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø¹Ù‹Ø§ Ù†ØªÙƒÙ„Ù… Ø¨Ø«Ù‚Ø©</title>
<style>
/* ====== Reset ====== */
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family:'Cairo', Tahoma, Arial, sans-serif; background:#f0f8ff; text-align:center; color:#333;}

/* ====== Canvas Confetti ====== */
#confettiCanvas {position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1000;}

/* ====== Header ====== */
header {
  background: linear-gradient(135deg, #6dd5ed, #2193b0);
  color:white; padding:50px 20px; border-bottom-left-radius:50px; border-bottom-right-radius:50px;
  box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
header h1 {font-size:36px; margin-bottom:10px;}
header p {font-size:18px; max-width:700px; margin:auto; line-height:1.5;}

/* ====== Pages ====== */
section {padding:40px 20px;}
#startPage, #testPage, #resultPage {display:none; animation:fadeIn 0.5s ease;}
@keyframes fadeIn {from{opacity:0} to{opacity:1}}

/* ====== Buttons ====== */
button {
  background:#ff6b6b; color:white; border:none; padding:14px 30px; border-radius:30px;
  font-size:16px; cursor:pointer; margin-top:15px; transition:0.3s;
}
button:hover {background:#ff4757;}

/* ====== Inputs ====== */
input, textarea {
  width:80%; max-width:400px; padding:12px; margin:10px 0; border-radius:12px;
  border:1px solid #ccc; font-size:16px;
}
textarea {resize:none;}

/* ====== Cards ====== */
.cards {display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-top:30px;}
.card {
  background:white; padding:25px; border-radius:20px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
  transition:0.3s; cursor:default;
}
.card:hover {transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.card h3 {color:#ff6b6b; margin-bottom:15px;}

/* ====== Video ====== */
iframe {border-radius:15px; margin-top:20px;}

/* ====== Result Text ====== */
#resultText {font-size:20px; margin-top:20px; font-weight:bold;}
</style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- ====== Start Page ====== -->
<div id="startPage">
  <header>
    <h1>Ù…Ø¹Ù‹Ø§ Ù†ØªÙƒÙ„Ù… Ø¨Ø«Ù‚Ø©</h1>
    <p>Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ¹ÙÙ…Ø±Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø·Ù‚ ÙˆØ§Ù„ØªØ£ØªØ£Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù…ØªØ¹Ø© ÙˆÙˆØ§Ù‚Ø¹ÙŠØ©.</p>
  </header>
  <section>
    <input type="text" id="name" placeholder="Ø§Ø³Ù…Ùƒ"><br>
    <input type="number" id="age" placeholder="Ø¹Ù…Ø±Ùƒ"><br>
    <button onclick="startTest()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
  </section>
</div>

<!-- ====== Test Page ====== -->
<div id="testPage">
  <section>
    <h2>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø·Ù‚</h2>
    <p>Ø§Ù‚Ø±Ø£ Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨ØµÙˆØª ÙˆØ§Ø¶Ø­:</p>
    <p style="font-size:20px; font-weight:bold; color:#ff6b6b;">"Ø£Ù†Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ­Ø¯Ø« Ø¨Ø«Ù‚Ø© ÙˆÙ‡Ø¯ÙˆØ¡"</p>
    <button id="recordBtn" onclick="recordVoice()">ğŸ™ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª</button>
    <p id="timer"></p>
  </section>
</div>

<!-- ====== Result Page ====== -->
<div id="resultPage">
  <section>
    <h2>Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
    <p id="resultText"></p>
    <div id="videoArea" style="display:none;">
      <h3>ÙÙŠØ¯ÙŠÙˆ ØªØ¯Ø±ÙŠØ¨ÙŠ Ù…Ù‚ØªØ±Ø­</h3>
      <iframe width="100%" height="315" src="https://www.youtube.com/embed/1zXb5b8b8b8" allowfullscreen></iframe>
    </div>
    <button onclick="restartTest()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
  </section>
</div>

<script>
// ======== Ø§Ù„ØµÙØ­Ø§Øª ========
const startPage = document.getElementById('startPage');
const testPage = document.getElementById('testPage');
const resultPage = document.getElementById('resultPage');

startPage.style.display='block';
function startTest(){
  if(!document.getElementById('name').value || !document.getElementById('age').value){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¹Ù…Ø±");
    return;
  }
  startPage.style.display='none';
  testPage.style.display='block';
}

// ======== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª ========
let audioChunks = [];
let mediaRecorder;
let audioContext = new (window.AudioContext || window.webkitAudioContext)();

function recordVoice(){
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    mediaRecorder = new MediaRecorder(stream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e=>audioChunks.push(e.data);
    mediaRecorder.onstop = processAudio;

    mediaRecorder.start();
    let seconds=0;
    document.getElementById('timer').innerText='0 Ø«Ø§Ù†ÙŠØ©';
    let timer = setInterval(()=>{
      seconds++;
      document.getElementById('timer').innerText=seconds + " Ø«Ø§Ù†ÙŠØ©";
      if(seconds>=6){
        clearInterval(timer);
        mediaRecorder.stop();
      }
    },1000);
  });
}

// ======== ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØª ========
function processAudio(){
  const audioBlob = new Blob(audioChunks,{type:'audio/webm'});
  const fileReader = new FileReader();
  fileReader.onloadend = function(){
    audioContext.decodeAudioData(fileReader.result).then(buffer=>{
      const channelData = buffer.getChannelData(0);
      const duration = buffer.duration;

      // Ø­Ø³Ø§Ø¨ ØªÙˆÙ‚ÙØ§Øª Ø·ÙˆÙŠÙ„Ø©
      let threshold = 0.02; // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØª ÙŠØ¹ØªØ¨Ø± ØµØ§Ù…Øª
      let minSilence = 0.3; // Ø«ÙˆØ§Ù†ÙŠ
      let silenceTime=0, pauses=0;
      for(let i=0;i<channelData.length;i++){
        if(Math.abs(channelData[i])<threshold){
          silenceTime+=1/audioContext.sampleRate;
          if(silenceTime>=minSilence){
            pauses++;
            silenceTime=0;
          }
        } else silenceTime=0;
      }

      // Ø­Ø³Ø§Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø·Ù„Ø§Ù‚Ø©
      let fluencyScore = 1 - Math.min(pauses/5,1);
      fluencyScore = Math.max(0, Math.min(1, fluencyScore));

      showResult(fluencyScore);
    });
  }
  fileReader.readAsArrayBuffer(audioBlob);
}

// ======== Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© ========
function showResult(score){
  testPage.style.display='none';
  resultPage.style.display='block';
  const resultText = document.getElementById('resultText');
  const videoArea = document.getElementById('videoArea');

  if(score>0.9){
    resultText.innerText="ğŸ‰ ØµÙˆØªÙƒ Ù…Ù…ØªØ§Ø²! Ù…Ø¨Ø±ÙˆÙƒ!";
    videoArea.style.display='none';
    confetti();
  } else if(score>0.7){
    resultText.innerText="âš ï¸ ØªØ­ØªØ§Ø¬ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ù„Ø§Ù‚Ø©. Ø´Ø§Ù‡Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ.";
    videoArea.style.display='block';
  } else {
    resultText.innerText="âŒ ØªØ£ØªØ£Ø© ÙˆØ§Ø¶Ø­Ø©. ØªØ§Ø¨Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠ.";
    videoArea.style.display='block';
  }
}

// ======== Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ========
function restartTest(){
  resultPage.style.display='none';
  startPage.style.display='block';
}

// ======== Confetti ========
function confetti(){
  const canvas = document.getElementById('confettiCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const pieces = [];
  for(let i=0;i<150;i++){
    pieces.push({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height-canvas.height,
      r:Math.random()*6+4,
      d:Math.random()*20+10,
      color:`hsl(${Math.random()*360},100%,50%)`,
      tilt:Math.random()*10-10
    });
  }
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let p of pieces){
      ctx.beginPath();
      ctx.fillStyle=p.color;
      ctx.moveTo(p.x + p.tilt, p.y);
      ctx.arc(p.x + p.tilt, p.y, p.r,0,Math.PI*2);
      ctx.fill();
      p.y += Math.sin(p.d) +1;
      p.x += Math.sin(p.d);
      if(p.y>canvas.height){p.y=-10; p.x=Math.random()*canvas.width;}
    }
    requestAnimationFrame(draw);
  }
  draw();
}
</script>

</body>
</html>
